<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExperienceMaker - Experience Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .experience-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .experience-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left-color: #3b82f6;
        }
        .tag-chip {
            transition: all 0.2s ease;
        }
        .tag-chip:hover {
            transform: scale(1.05);
        }
        .tag-chip.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-12">
        <div class="container mx-auto px-6">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-4">
                    <i class="fas fa-brain mr-3"></i>ExperienceMaker
                </h1>
                <p class="text-xl opacity-90">Discover and explore curated AI agent experiences</p>
                <div class="mt-6 flex justify-center items-center space-x-4 text-sm">
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                        <i class="fas fa-database mr-1"></i>
                        <span id="total-experiences">Loading...</span> Experiences
                    </span>
                    <span class="bg-white bg-opacity-20 px-3 py-1 rounded-full">
                        <i class="fas fa-tags mr-1"></i>
                        <span id="total-libraries">Loading...</span> Libraries
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        <!-- Search and Filter Section -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
            <div class="flex flex-col lg:flex-row gap-4 items-center">
                <!-- Search Input -->
                <div class="flex-1 relative">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    <input
                        id="search-input"
                        type="text"
                        placeholder="Search experiences by content, usage scenario, or author..."
                        class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                    >
                </div>
                <!-- Clear Button -->
                <button
                    id="clear-filters"
                    class="px-6 py-3 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors duration-200"
                >
                    <i class="fas fa-times mr-2"></i>Clear All
                </button>
            </div>

            <!-- Tags Filter -->
            <div class="mt-6">
                <h3 class="text-sm font-semibold text-gray-700 mb-3">Filter by Library:</h3>
                <div id="tags-container" class="flex flex-wrap gap-2">
                    <!-- Tags will be dynamically inserted here -->
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loading" class="text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-600">Loading experience library...</p>
        </div>

        <!-- Error State -->
        <div id="error" class="hidden text-center py-12">
            <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
            <p class="text-gray-600 mb-4">Failed to load experience library</p>
            <button onclick="loadExperiences()" class="px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                Try Again
            </button>
        </div>

        <!-- Results Info -->
        <div id="results-info" class="hidden mb-6">
            <p class="text-gray-600">
                Showing <span id="results-count" class="font-semibold text-blue-600">0</span>
                of <span id="total-count" class="font-semibold">0</span> experiences
            </p>
        </div>

        <!-- Experiences Grid -->
        <div id="experiences-container" class="hidden grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <!-- Experience cards will be dynamically inserted here -->
        </div>

        <!-- No Results -->
        <div id="no-results" class="hidden text-center py-12">
            <i class="fas fa-search text-gray-300 text-4xl mb-4"></i>
            <p class="text-gray-600 mb-2">No experiences found</p>
            <p class="text-gray-400 text-sm">Try adjusting your search criteria or filters</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 py-8 mt-16">
        <div class="container mx-auto px-6 text-center text-gray-600">
            <p>
                <i class="fas fa-code mr-2"></i>
                Built with ❤️ for the AI community •
                <a href="https://github.com/Dengjiaji/experiencemaker" class="text-blue-500 hover:text-blue-600">
                    View on GitHub
                </a>
            </p>
        </div>
    </footer>

    <script>
        let allExperiences = [];
        let filteredExperiences = [];
        let activeTags = new Set();

        // GitHub API configuration
        const GITHUB_USER = 'Dengjiaji';  // 替换为你的GitHub用户名
        const REPO_NAME = 'agent.exe';   // 替换为你的仓库名
        const EXPERIENCE_FOLDER = 'experience_library';

        // DOM elements
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const resultsInfoEl = document.getElementById('results-info');
        const experiencesContainer = document.getElementById('experiences-container');
        const noResultsEl = document.getElementById('no-results');
        const tagsContainer = document.getElementById('tags-container');
        const searchInput = document.getElementById('search-input');
        const clearFiltersBtn = document.getElementById('clear-filters');
        const totalExperiencesEl = document.getElementById('total-experiences');
        const totalLibrariesEl = document.getElementById('total-libraries');
        const resultsCountEl = document.getElementById('results-count');
        const totalCountEl = document.getElementById('total-count');

        // Load experiences on page load
        document.addEventListener('DOMContentLoaded', loadExperiences);

        // Event listeners
        searchInput.addEventListener('input', debounce(filterExperiences, 300));
        clearFiltersBtn.addEventListener('click', clearAllFilters);

        async function loadExperiences() {
            try {
                showLoading();

                // Get list of files in experience_library folder
                const response = await fetch(`https://api.github.com/repos/${GITHUB_USER}/${REPO_NAME}/${EXPERIENCE_FOLDER}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const files = await response.json();
                const jsonlFiles = files.filter(file => file.name.endsWith('.jsonl'));

                if (jsonlFiles.length === 0) {
                    throw new Error('No JSONL files found in experience_library folder');
                }

                // Load and parse all JSONL files
                const experiencePromises = jsonlFiles.map(async (file) => {
                    const fileResponse = await fetch(file.download_url);
                    const content = await fileResponse.text();

                    const experiences = content
                        .split('\n')
                        .filter(line => line.trim())
                        .map(line => {
                            try {
                                const experience = JSON.parse(line);
                                experience._library = file.name.replace('.jsonl', '');
                                return experience;
                            } catch (e) {
                                console.warn('Failed to parse line:', line);
                                return null;
                            }
                        })
                        .filter(exp => exp !== null);

                    return experiences;
                });

                const experienceArrays = await Promise.all(experiencePromises);
                allExperiences = experienceArrays.flat();

                // Update stats
                totalExperiencesEl.textContent = allExperiences.length;
                totalLibrariesEl.textContent = jsonlFiles.length;

                // Generate tags
                generateTagsFilter();

                // Initial display
                filteredExperiences = [...allExperiences];
                displayExperiences();
                hideLoading();

            } catch (error) {
                console.error('Error loading experiences:', error);
                showError();
            }
        }

        function generateTagsFilter() {
            const libraries = [...new Set(allExperiences.map(exp => exp._library))];

            tagsContainer.innerHTML = libraries
                .sort()
                .map(library => `
                    <button class="tag-chip px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-medium hover:bg-gray-200"
                            data-tag="${library}">
                        ${library}
                    </button>
                `).join('');

            // Add event listeners to tag buttons
            tagsContainer.querySelectorAll('.tag-chip').forEach(chip => {
                chip.addEventListener('click', () => toggleTag(chip));
            });
        }

        function toggleTag(chipElement) {
            const tag = chipElement.dataset.tag;

            if (activeTags.has(tag)) {
                activeTags.delete(tag);
                chipElement.classList.remove('active');
            } else {
                activeTags.add(tag);
                chipElement.classList.add('active');
            }

            filterExperiences();
        }

        function filterExperiences() {
            const searchTerm = searchInput.value.toLowerCase();

            filteredExperiences = allExperiences.filter(experience => {
                // Filter by active tags
                if (activeTags.size > 0 && !activeTags.has(experience._library)) {
                    return false;
                }

                // Filter by search term
                if (searchTerm) {
                    const searchableText = [
                        experience.when_to_use || '',
                        experience.content || '',
                        experience.metadata?.author || '',
                        experience._library || ''
                    ].join(' ').toLowerCase();

                    return searchableText.includes(searchTerm);
                }

                return true;
            });

            displayExperiences();
        }

        function displayExperiences() {
            if (filteredExperiences.length === 0) {
                showNoResults();
                return;
            }

            experiencesContainer.innerHTML = filteredExperiences.map(experience => `
                <div class="experience-card bg-white rounded-lg shadow-sm p-6 fade-in">
                    <!-- Header -->
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center space-x-2">
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full">
                                ${experience._library}
                            </span>
                            ${experience.score ? `
                                <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">
                                    Score: ${experience.score}
                                </span>
                            ` : ''}
                        </div>
                        <i class="fas fa-lightbulb text-yellow-500"></i>
                    </div>

                    <!-- When to use -->
                    <div class="mb-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-compass mr-1"></i>When to use:
                        </h3>
                        <p class="text-gray-600 text-sm leading-relaxed">
                            ${experience.when_to_use || 'No specific guidance provided'}
                        </p>
                    </div>

                    <!-- Content -->
                    <div class="mb-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-quote-left mr-1"></i>Experience:
                        </h3>
                        <p class="text-gray-800 text-sm leading-relaxed">
                            ${experience.content || 'No content available'}
                        </p>
                    </div>

                    <!-- Footer -->
                    <div class="flex items-center justify-between text-xs text-gray-500 pt-4 border-t border-gray-100">
                        <div class="flex items-center space-x-4">
                            <span>
                                <i class="fas fa-user mr-1"></i>
                                ${experience.metadata?.author || 'Unknown'}
                            </span>
                            ${experience.metadata?.created_time ? `
                                <span>
                                    <i class="fas fa-calendar mr-1"></i>
                                    ${new Date(experience.metadata.created_time).toLocaleDateString()}
                                </span>
                            ` : ''}
                        </div>
                        <span class="text-gray-400">
                            ID: ${experience.experience_id.substring(0, 8)}...
                        </span>
                    </div>
                </div>
            `).join('');

            showResults();

            // Update results count
            resultsCountEl.textContent = filteredExperiences.length;
            totalCountEl.textContent = allExperiences.length;
        }

        function clearAllFilters() {
            searchInput.value = '';
            activeTags.clear();

            // Remove active class from all tag chips
            tagsContainer.querySelectorAll('.tag-chip').forEach(chip => {
                chip.classList.remove('active');
            });

            filteredExperiences = [...allExperiences];
            displayExperiences();
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // UI state management
        function showLoading() {
            loadingEl.classList.remove('hidden');
            errorEl.classList.add('hidden');
            resultsInfoEl.classList.add('hidden');
            experiencesContainer.classList.add('hidden');
            noResultsEl.classList.add('hidden');
        }

        function hideLoading() {
            loadingEl.classList.add('hidden');
        }

        function showError() {
            loadingEl.classList.add('hidden');
            errorEl.classList.remove('hidden');
            resultsInfoEl.classList.add('hidden');
            experiencesContainer.classList.add('hidden');
            noResultsEl.classList.add('hidden');
        }

        function showResults() {
            resultsInfoEl.classList.remove('hidden');
            experiencesContainer.classList.remove('hidden');
            noResultsEl.classList.add('hidden');
        }

        function showNoResults() {
            resultsInfoEl.classList.add('hidden');
            experiencesContainer.classList.add('hidden');
            noResultsEl.classList.remove('hidden');
        }
    </script>
</body>
</html>
